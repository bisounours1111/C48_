<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Affichage AQI Actuel</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
  <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-md">
    <!-- Titre -->
    <h1 class="text-2xl font-bold text-center mb-6">Indice de Qualité de l'Air (AQI)</h1>

    <!-- Conteneur pour le demi-anneau -->
    <div class="relative w-64 h-32 mx-auto mb-6">
      <canvas id="aqiChart"></canvas>
      <!-- Affichage de la valeur AQI au centre -->
      <div class="absolute inset-0 flex items-center justify-center">
        <p class="text-4xl font-bold" id="aqiValue">--</p>
      </div>
    </div>

    <!-- Statut AQI -->
    <p class="text-center text-gray-600 text-lg" id="aqiStatus">Chargement...</p>
  </div>

  <script>
    // Fonction pour déterminer la couleur et le statut en fonction de l'AQI
    function getAQIColorAndStatus(aqi) {
      if (aqi <= 50) return { color: '#10B981', status: 'Bon' }; // Vert
      if (aqi <= 100) return { color: '#FBBF24', status: 'Modéré' }; // Jaune
      if (aqi <= 150) return { color: '#F97316', status: 'Malsain pour les groupes sensibles' }; // Orange
      if (aqi <= 200) return { color: '#EF4444', status: 'Malsain' }; // Rouge
      if (aqi <= 300) return { color: '#8B5CF6', status: 'Très malsain' }; // Violet
      return { color: '#6B7280', status: 'Dangereux' }; // Gris
    }

    // Fonction pour mettre à jour l'affichage
    function updateAQIDisplay(aqi) {
      const aqiValueElement = document.getElementById('aqiValue');
      const aqiStatusElement = document.getElementById('aqiStatus');

      const { color, status } = getAQIColorAndStatus(aqi);

      aqiValueElement.textContent = aqi;
      aqiStatusElement.textContent = status;
      aqiStatusElement.style.color = color;

      // Mettre à jour le graphique
      aqiChart.data.datasets[0].data = [aqi, 300 - aqi];
      aqiChart.data.datasets[0].backgroundColor = [color, '#F3F4F6'];
      aqiChart.update();
    }

    // Configuration du graphique en demi-anneau
    const data = {
      labels: ['AQI', ''],
      datasets: [{
        data: [0, 300], // Valeur initiale
        backgroundColor: ['#F3F4F6', '#F3F4F6'], // Couleur initiale
        borderWidth: 0,
        circumference: 180, // Demi-cercle
        rotation: -90, // Commence en haut
      }]
    };

    const config = {
      type: 'doughnut',
      data: data,
      options: {
        responsive: true,
        cutout: '70%', // Taille du trou au centre
        plugins: {
          legend: {
            display: false, // Masquer la légende
          },
          tooltip: {
            enabled: false, // Désactiver les infobulles
          },
        },
      },
    };

    // Initialisation du graphique
    const aqiChart = new Chart(document.getElementById('aqiChart'), config);

    // Exemple : Mettre à jour l'AQI avec une valeur aléatoire
    const randomAQI = Math.floor(Math.random() * 300) + 1;
    updateAQIDisplay(randomAQI);
  </script>
</body>
</html>